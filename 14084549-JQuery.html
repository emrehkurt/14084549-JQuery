<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/spinbox/latest/jqm-spinbox.min.js"></script>
</head>
<body>

<script>
var chosenItems = {};

$( document ).ready(function() {
    // you can only save strings to local storage
	// so all js objects have to be saved in the form JSON.stringify()
	// and retrieved in the format JSON.parse(obj)
    var q = localStorage.getItem("previousList");
	if (q!=null) chosenItems = JSON.parse(q);
});



function gotoQuantity(obj)
{

	vegetablesChosen = $(obj).text();
	$("#vegname").text(vegetablesChosen);
	$.mobile.changePage("#quantity");



}

function showChosenItems()
{


	//remove existing items from shopping list
	 $("#shoppingList").empty();

	 var keyz = [];
	 for (var key in chosenItems)  keyz.push(key);
	 keyz.sort();


	 //iterate through the sorted chosenItems
	 keyz.forEach(function(element) {
	  vegData = element + ":" +  chosenItems[element];
	  $('<li>').append('<a href="#">' + vegData + '</a>').appendTo('#shoppingList');
	 });

	//you have to navigate to the page after you have populated
	$.mobile.changePage("#finalShoppingList");
	 $("#shoppingList").listview('refresh');


}

function backToList()
{
	saveChoice();
	//$.mobile.changePage("#pageone");

}function addItem(){}

function saveChoice()
{
	vegetableChosen = $("#vegname").text();
	quantityChosen = $("#spin").val();
	$('#confirm').text(vegetableChosen + " : " + quantityChosen);
	$("#myPopup").popup("open");
	chosenItems[vegetableChosen] = quantityChosen;
	localStorage.setItem("previousList",JSON.stringify(chosenItems));
    setTimeout(function(){
		$("#spin").val(0);
		$("#vegname").text("");
		$.mobile.changePage("#pageone");
		showChosenItems();
		//must close popup after you have changed the page
		$("#myPopup").popup("close");
		}, 1000);
}
$( document ).ready(function() {
    $('.prod').click(function() {
		gotoQuantity($(this));
	});



});

$(document).ready(function(){ //Initally hides the search bar and shows it once it is clicked on search.

    $(".search").click(function(){
         $(".ui-filterable").toggle();
    });
	$(".ui-filterable").toggle();
});

</script>
<div data-role="page" id="pageone">
 <div style = background:# data-role="header">    <a class="search" data-icon="search">Search</a>    <h1> <p style="color:#000000" </p>Shopping List Application</h1>

  </div>
  <div data-role="main" class="ui-content">
    <form class="ui-filterable">
      <input display id="myFilter" data-type="search">
    </form>
	<div class="ui-grid-a">      <a style="float: left;" data-rel="popup" href="#remove" class="ui-btn">Remove Items</a>        <a style="float: right;" data-rel="popup" href="#purchases" class="ui-btn">Purchases</a>
      <div class="ui-block-a">
            <ul data-role="listview" data-filter="true" data-input="#myFilter" data-autodividers="true" data-inset="true">

    </ul>
      </div>
      <div class="ui-block-b">
        <div id="allVegetablesChosen">
			<ul data-role="listview" data-filter="true" data-sort="true" data-input="#myFilter" data-autodividers="true" data-inset="true" id="shoppingList">
			</ul>
		</div>
      </div>
    </div>
  </div>
  <div data-role="footer" data-position="fixed">
  <a style="float: right;" data-rel="popup" href="#quantity"  onclick="gotoQuantity(this)"  class="items">Add Item</a>
  <a style="float: right;" data-rel="popup" href="#addlist" class="ui-btn">Add List</a>
	</div>
</div>

<div data-role="page" id="quantity">
  <div data-role="main" class="ui-content"><div style = background:# data-role="header">    <a class="search" data-icon="home" onclick="backToList()">Home</a>    <h1> <p style="color:#000000"</p>Shopping List Application</h1>    </div>    </form>  	  <h1 id="vegname"></h1>
     <div class="ui-field-contain">
       <label for="item">Item:</label>       <input type="text" name="item" id="fullname">
       <input type="text" data-role="spinbox" name="spin" id="spin" value="0" min="0" max="10" />
      </div>
      <button onclick="backToList()">Confirm</button>
      <button onclick="showChosenItems()">Show Chosen Items</button>

	 <div data-role="popup" id="myPopup">
		<p id="confirm">This is a simple popup.</p>
	 </div>




<div data-role="page" id="itemitem"></div>

</body>
</html>